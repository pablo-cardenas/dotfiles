if ! tmux has-session -t imca; then
	tmux new-session -s imca -c ~/Development/flask_imca -n main -d

	tmux split-window -h -t imca -c ~/Development/flask_imca
	tmux split-window -h -t imca -c ~/Development/flask_imca
	tmux select-layout -t imca main-vertical

	tmux send-keys -t imca:0.0 'source venv/bin/activate' C-m
	tmux send-keys -t imca:0.0 'vim -S ~/.vim/session/imca.vim' C-m

	tmux send-keys -t imca:0.1 'source venv/bin/activate' C-m
	tmux send-keys -t imca:0.1 'export FLASK_ENV=development' C-m
	tmux send-keys -t imca:0.1 'export FLASK_APP=flask_imca' C-m
	command -v firefox-developer-edition >/dev/null 2>&1 && tmux send-keys -t imca:0.1 'sleep 6s && firefox-developer-edition 127.0.0.1:5000 &' C-m ||
	command -v firefox >/dev/null 2>&1 && tmux send-keys -t imca:0.1 'sleep 6s && firefox 127.0.0.1:5000 &' C-m
	tmux send-keys -t imca:0.1 'flask run --host 0.0.0.0' C-m

	tmux send-keys -t imca:0.2 'source venv/bin/activate' C-m
	tmux send-keys -t imca:0.2 'export FLASK_APP=flask_imca' C-m
	tmux send-keys -t imca:0.2 'flask webpack clean' C-m
	tmux send-keys -t imca:0.2 'flask webpack create' C-m
	tmux send-keys -t imca:0.2 'flask webpack install' C-m
	tmux send-keys -t imca:0.2 'flask webpack run watch &' C-m
	tmux send-keys -t imca:0.2 'find src/flask_imca/webpack | entr -s "rm -rf src/instance/assets/src/* && flask webpack create"' C-m

	tmux new-window -c ~/Development/flask_imca -n venv
	tmux send-keys -t imca:1.0 'source venv/bin/activate' C-m
	tmux send-keys -t imca:1.0 'export FLASK_ENV=development' C-m
	tmux send-keys -t imca:1.0 'export FLASK_APP=flask_imca' C-m

	tmux new-window -c ~/Development/flask_imca/src/instance -n instance

	tmux select-window -t imca:0
	tmux select-pane -t imca:0.0
fi

tmux attach -t imca
